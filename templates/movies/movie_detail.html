{% extends 'base.html' %}
{% load static i18n %}
{% load i18n %}

{% block title %}{{ movie.title_uz }} ({{ movie.year }}) - {{ SITE_NAME }}{% endblock %}

{% block meta_description %}{{ movie.description_uz|truncatewords:25 }}{% endblock %}
{% block meta_keywords %}{{ movie.title_az|default:movie.title_uz }}, {% for genre in movie.genres.all %}{{ genre.name_az|default:genre.name_uz }}, {% endfor %}{% for actor in movie.actors.all|slice:":5" %}{{ actor.name }}, {% endfor %}{{ movie.year }}{% endblock %}

{% block og_title %}{{ movie.title_uz }} ({{ movie.year }}) - Onlayn tomosha qiling{% endblock %}
{% block og_description %}{{ movie.description_uz|truncatewords:25 }}{% endblock %}
{% block og_image %}{{ movie.poster.url }}{% endblock %}


{% block extra_css %}
<style>
    .movie-detail-hero {
        position: relative;
        height: 500px;
        background-size: cover;
        background-position: center;
        margin-top: -80px;
        padding-top: 80px;
    }
    
    .movie-detail-hero::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(to bottom, rgba(18, 18, 18, 0.3) 0%, rgba(18, 18, 18, 0.95) 100%);
    }
    
    .detail-content {
        position: relative;
        z-index: 2;
        padding-top: 120px;
    }
    
    .detail-poster {
        border-radius: 15px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
        width: 100%;
        max-width: 350px;
    }
    
    .rating-widget {
        display: flex;
        gap: 5px;
        font-size: 2rem;
        cursor: pointer;
    }
    
    
    .rating-widget .star {
        color: #555;
        transition: color 0.2s ease;
    }
    
    .rating-widget .star.active,
    .rating-widget .star:hover,
    .rating-widget .star:hover ~ .star {
        color: #ffc107;
    }
    
    .comment-section {
        background: var(--card-bg);
        border-radius: 10px;
        padding: 30px;
        margin-top: 30px;
    }
    
    .comment-item {
        background: rgba(255, 255, 255, 0.05);
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 15px;
    }
    
    .comment-author {
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 5px;
    }
    
    .comment-date {
        font-size: 0.85rem;
        color: var(--text-gray);
    }
    
    .trailer-modal .modal-content {
        background: #000;
    }
    
    .trailer-container {
        position: relative;
        padding-bottom: 56.25%;
        height: 0;
        overflow: hidden;
    }
    
    .trailer-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="movie-detail-hero" style="background-image: url('{% if movie.backdrop %}{{ movie.backdrop.url }}{% elif movie.poster %}{{ movie.poster.url }}{% else %}{% static 'img/no-poster.png' %}{% endif %}');">
    <!-- –≠—Ç–æ—Ç –±–ª–æ–∫ —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –¥–ª—è —Ñ–æ–Ω–∞ -->
</div>

<!-- Main Content -->
<div class="container detail-content" style="margin-top: -250px; position: relative; z-index: 2;">
    <div class="row">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ —Å –ø–æ—Å—Ç–µ—Ä–æ–º -->
        <div class="col-lg-4 mb-4">
            <img src="{% if movie.poster %}{{ movie.poster.url }}{% else %}{% static 'img/no-poster.png' %}{% endif %}" alt="{{ movie.title_uz }}" class="detail-poster">
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π -->
        <div class="col-lg-8">
            <h1 class="display-4 fw-bold mb-3">
                {{ movie.title_uz }}
            </h1>

            {% if movie.original_title and movie.original_title != movie.title_uz %}
            <p class="text-muted h5 mb-4">{{ movie.original_title }}</p>
            {% endif %}

            <div class="d-flex flex-wrap gap-4 mb-4">
                <div>
                    <span class="text-white"><i class="fas fa-calendar"></i> {% trans "–ì–æ–¥" %}:</span>
                    <strong class="text-danger">{{ movie.year }}</strong>
                </div>
                {% if movie.duration %}
                <div>
                    <span class="text-white"><i class="fas fa-clock"></i> {% trans "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å" %}:</span>
                    <strong class="text-danger">{{ movie.duration }} {% trans "–º–∏–Ω" %}</strong>
                </div>
                {% endif %}
                <div>
                    <span class="text-white"><i class="fas fa-eye"></i> {% trans "–ü—Ä–æ—Å–º–æ—Ç—Ä—ã" %}:</span>
                    <strong class="text-danger">{{ movie.views }}</strong>
                </div>
                <div>
                    <span class="text-white"><i class="fas fa-star text-warning"></i> {% trans "–†–µ–π—Ç–∏–Ω–≥" %}:</span>
                    <strong class="text-danger">{{ movie.rating_avg|floatformat:1 }} / 5.0</strong>
                    <small class="text-white">({{ movie.rating_count }} {% trans "–æ—Ü–µ–Ω–æ–∫" %})</small>
                </div>
            </div>

            <div class="mb-4">
                <strong><i class="fas fa-list"></i> {% trans "Janrlar" %}:</strong>
                {% for genre in movie.genres.all %}
                <a href="{% url 'genre' genre.slug %}" class="badge bg-danger text-white ms-2">
                    {{ genre.name_az|default:genre.name_uz }}
                </a>
                {% empty %}
                 <span class="ms-2 text-muted">{% trans "–ù–µ —É–∫–∞–∑–∞–Ω–æ" %}</span>
                {% endfor %}
            </div>

            <div class="mb-4">
                <strong><i class="fas fa-globe"></i> {% trans "–°—Ç—Ä–∞–Ω—ã" %}:</strong>
                {% for country in movie.countries.all %}
                <span class="badge bg-secondary ms-2">
                    {{ country.name_az|default:country.name_uz }}
                </span>
                {% empty %}
                <span class="ms-2 text-muted">{% trans "–ù–µ —É–∫–∞–∑–∞–Ω–æ" %}</span>
                {% endfor %}
            </div>

            <div class="d-flex flex-wrap gap-3 mb-4">
                {% if movie.video_file %}
                <a href="{{ movie.video_file.url }}" class="btn btn-danger btn-lg" target="_blank">
                    <i class="fas fa-play-circle"></i> Film…ô bax
                </a>
                {% endif %}
                {% if movie.trailer_url %}
                <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#trailerModal">
                    <i class="fas fa-play"></i> Treyler…ô bax
                </button>
                {% endif %}

                {% if user.is_authenticated %}
                <button class="btn btn-outline-light favorite-btn" data-type="movie" data-id="{{ movie.id }}">
                    <i class="{% if is_favorite %}fas{% else %}far{% endif %} fa-heart"></i>
                    {% trans "–ò–∑–±—Ä–∞–Ω–Ω–æ–µ" %}
                </button>
                <button class="btn btn-outline-light watchlist-btn" data-type="movie" data-id="{{ movie.id }}">
                    <i class="{% if in_watchlist %}fas{% else %}far{% endif %} fa-bookmark"></i>
                    {% trans "–ú–æ–π —Å–ø–∏—Å–æ–∫" %}
                </button>
                {% endif %}

                <button class="btn btn-outline-light" data-bs-toggle="modal" data-bs-target="#shareModal">
                    <i class="fas fa-share-alt"></i> {% trans "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" %}
                </button>
            </div>
        </div>
    </div>
</div>

<!-- –û–ø–∏—Å–∞–Ω–∏–µ –∏ –ê–∫—Ç–µ—Ä—ã -->
<div class="container my-5">
     <!-- Schema.org markup for SEO -->
     <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Movie",
        "name": "{{ movie.title_uz }}",
        "image": "{% if movie.poster %}{{ movie.poster.url }}{% else %}{% static 'img/no-poster.png' %}{% endif %}",
        "datePublished": "{{ movie.year }}",
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "{{ movie.rating_avg }}",
            "ratingCount": "{{ movie.rating_count }}",
            "bestRating": "5",
            "worstRating": "1"
        },
        "description": "{{ movie.description_uz|striptags }}",
        "director": [
            {% for director in movie.directors.all %}
            {
                "@type": "Person",
                "name": "{{ director.name }}"
            },
            {% endfor %}
        ],
        "actor": [
            {% for actor in movie.actors.all|slice:":10" %}
            {
                "@type": "Person",
                "name": "{{ actor.name }}"
            },
            {% endfor %}
        ]
    }
    </script>

    <div class="row">
        <div class="col-lg-8">
            <h2 class="mb-4"><i class="fas fa-info-circle"></i> {% trans "–û–ø–∏—Å–∞–Ω–∏–µ" %}</h2>
            <div class="content-text">
                {{ movie.description_az|default:movie.description_uz|safe }}
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Cast & Crew -->
            {% if movie.directors.all %}
            <div class="mb-4">
                <h5><i class="fas fa-user-tie"></i> {% trans "–†–µ–∂–∏—Å—Å–µ—Ä—ã" %}</h5>
                <ul class="list-unstyled">
                    {% for director in movie.directors.all %}
                    <li>{{ director.name }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            {% if movie.actors.all %}
            <div class="mb-4">
                <h5><i class="fas fa-users"></i> {% trans "–í —Ä–æ–ª—è—Ö" %}</h5>
                <ul class="list-unstyled">
                    {% for actor in movie.actors.all|slice:":10" %}
                    <li>{{ actor.name }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Rating Section -->
    {% if user.is_authenticated %}
    <div class="row mt-5">
        <div class="col-lg-8">
            <div class="comment-section">
                <h3 class="mb-4"><i class="fas fa-star"></i> {% trans "–û—Ü–µ–Ω–∏—Ç–µ —Ñ–∏–ª—å–º" %}</h3>
                <div class="rating-widget" id="ratingWidget" data-movie-id="{{ movie.id }}">
                    {% for i in "12345" %}
                    <span class="star {% if user_rating and forloop.counter <= user_rating %}active{% endif %}" data-value="{{ forloop.counter }}">
                        <i class="fas fa-star"></i>
                    </span>
                    {% endfor %}
                </div>
                <p class="mt-2 text-white">
                    {% if user_rating %}
                        {% trans "–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞" %}: <strong class="text-danger">{{ user_rating }}/5</strong>
                    {% else %}
                        {% trans "–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–≤–µ–∑–¥—É –¥–ª—è –æ—Ü–µ–Ω–∫–∏" %}
                    {% endif %}
                </p>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Comments Section -->
    <div class="row">
        <div class="col-lg-8">
            <div class="comment-section">
                <h3 class="mb-4">
                    <i class="fas fa-comments"></i> 
                    {% trans "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏" %} ({{ comments.count }})
                </h3>
                
                {% if user.is_authenticated %}
                <form id="commentForm" class="mb-4">
                    {% csrf_token %}
                    <div class="mb-3">
                        <textarea class="form-control" name="text" rows="4" placeholder="{% trans '–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π...' %}" required></textarea>
                    </div>
                    
                    <!-- Google reCAPTCHA (–æ—Ç–∫–ª—é—á–µ–Ω–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏) -->
                    <div class="mb-3">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> {% trans "reCAPTCHA –æ—Ç–∫–ª—é—á–µ–Ω–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏" %}
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" id="commentSubmitBtn">
                        <i class="fas fa-paper-plane"></i> {% trans "–û—Ç–ø—Ä–∞–≤–∏—Ç—å" %}
                    </button>
                    <p class="text-white small mt-2">
                        <i class="fas fa-info-circle"></i> {% trans "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç –º–æ–¥–µ—Ä–∞—Ü–∏—é" %}
                    </p>
                </form>
                {% else %}
                <p class="alert alert-info">
                    <i class="fas fa-sign-in-alt"></i>
                    <a href="{% url 'account_login' %}">{% trans "–í–æ–π–¥–∏—Ç–µ" %}</a> {% trans "—á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" %}
                </p>
                {% endif %}
                
                <!-- Comments List -->
                <div id="commentsList">
                    {% for comment in comments %}
                    <div class="comment-item">
                        <div class="comment-author">
                            <i class="fas fa-user-circle"></i> {{ comment.user.username }}
                        </div>
                        <div class="comment-date">{{ comment.created_at|date:"d M Y, H:i" }}</div>
                        <div class="comment-text mt-2">{{ comment.text }}</div>
                    </div>
                    {% empty %}
                    <p class="text-white">{% trans "–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤" %}</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Similar Movies -->
    {% if similar_movies %}
    <div class="row mt-5">
        <div class="col-12">
            <h3 class="mb-4"><i class="fas fa-film"></i> {% trans "–ü–æ—Ö–æ–∂–∏–µ —Ñ–∏–ª—å–º—ã" %}</h3>
            <div class="content-grid">
                {% for similar in similar_movies %}
                <div class="movie-card">
                    <div class="movie-poster">
                        <img src="{{ similar.poster.url }}" alt="{{ similar.title_uz }}" loading="lazy">
                    </div>
                    <div class="movie-info">
                        <h3 class="movie-title">
                            <a href="{{ similar.get_absolute_url }}">
                                {{ similar.title_uz }}
                            </a>
                        </h3>
                        <div class="movie-meta">
                            <span>{{ similar.year }}</span>
                            <span class="movie-rating">
                                <i class="fas fa-star"></i> {{ similar.rating_avg|floatformat:1 }}
                            </span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- Trailer Modal -->
{% if movie.trailer_url %}
<div class="modal fade trailer-modal" id="trailerModal" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0">
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-0">
                <div class="trailer-container" id="trailerContainer"></div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/favorites.js' %}"></script>
<script>
    // Rating functionality
    $('#ratingWidget .star').on('click', function() {
        const rating = $(this).data('value');
        const movieId = $('#ratingWidget').data('movie-id');
        
        $.ajax({
            url: `/api/movies/${movieId}/rate/`,
            method: 'POST',
            data: { score: rating },
            success: function(response) {
                $('#ratingWidget .star').removeClass('active');
                $('#ratingWidget .star').each(function(index) {
                    if (index < rating) {
                        $(this).addClass('active');
                    }
                });
                showToast('–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ü–µ–Ω–∫—É!', 'success');
                // Reload page to update average rating
                setTimeout(() => location.reload(), 1500);
            },
            error: function() {
                showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ—Ü–µ–Ω–∫–∏', 'danger');
            }
        });
    });
    
    // Comment submission - –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–∞—è –≤–µ—Ä—Å–∏—è
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üé¨ Movie detail page loaded');
        
        const commentForm = document.getElementById('commentForm');
        const commentSubmitBtn = document.getElementById('commentSubmitBtn');
        
        console.log('Comment form found:', !!commentForm);
        console.log('Comment submit button found:', !!commentSubmitBtn);
        
        if (commentForm && commentSubmitBtn) {
            console.log('‚úÖ Comment form initialized');
            
            // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
            function submitComment() {
                console.log('üî• Comment form submitted');
                
                const textarea = commentForm.querySelector('textarea[name="text"]');
                const text = textarea.value.trim();
                
                console.log('Comment text:', text);
                
                if (!text) {
                    console.log('‚ùå Empty comment text');
                    showToast('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è', 'warning');
                    textarea.focus();
                    return false;
                }
                
                console.log('‚úÖ Comment text is valid, submitting...');
                
                // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏
                commentSubmitBtn.disabled = true;
                commentSubmitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –û—Ç–ø—Ä–∞–≤–∫–∞...';
                
                const formData = {
                    content_type: 'movie',
                    movie: {{ movie.id }},
                    text: text
                };
                
                console.log('Sending AJAX request to /api/comments/');
                console.log('Form data:', formData);
                
                $.ajax({
                    url: '/api/comments/',
                    method: 'POST',
                    data: formData,
                    headers: {
                        'X-CSRFToken': $('[name=csrfmiddlewaretoken]').val()
                    },
                    success: function(response) {
                        console.log('‚úÖ Comment submitted successfully:', response);
                        showToast('–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é', 'success');
                        // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
                        textarea.value = '';
                        textarea.focus();
                        // –¢–∞–∫–∂–µ –æ—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É –ø–æ–ª–Ω–æ—Å—Ç—å—é
                        commentForm.reset();
                    },
                    error: function(xhr, status, error) {
                        console.error('‚ùå Comment submission error:', error);
                        console.error('XHR status:', xhr.status);
                        console.error('XHR response:', xhr.responseText);
                        showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è', 'danger');
                    },
                    complete: function() {
                        console.log('üîÑ AJAX request completed');
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                        commentSubmitBtn.disabled = false;
                        commentSubmitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å';
                    }
                });
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
            commentForm.addEventListener('submit', function(e) {
                e.preventDefault();
                submitComment();
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ - —Ç–æ—á–Ω–æ –∫–∞–∫ Enter
            commentSubmitBtn.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('üî• Comment button clicked');
                submitComment();
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ Enter –≤ –ø–æ–ª–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
            const textarea = commentForm.querySelector('textarea[name="text"]');
            if (textarea) {
                textarea.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        console.log('üî• Comment Enter pressed');
                        submitComment();
                    }
                });
            }
        } else {
            console.log('‚ùå Comment form or button not found');
        }
    });
    
    // Load trailer on modal open
    {% if movie.trailer_url %}
    $('#trailerModal').on('shown.bs.modal', function() {
        initVideoPlayer('trailerContainer', '{{ movie.trailer_url }}');
    });
    
    $('#trailerModal').on('hidden.bs.modal', function() {
        $('#trailerContainer').html('');
    });
    {% endif %}
</script>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π -->
<div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header border-secondary">
                <h5 class="modal-title" id="shareModalLabel">
                    <i class="fas fa-share-alt"></i> {% trans "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ñ–∏–ª—å–º–æ–º" %}
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted mb-4">
                    {% trans "–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ü–∏–∞–ª—å–Ω—É—é —Å–µ—Ç—å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–∏–ª—å–º" %}
                </p>
                
                <div class="row g-3">
                    <!-- Telegram -->
                    <div class="col-6 col-md-4">
                        <button class="btn btn-outline-primary w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3" 
                                onclick="shareToTelegram()">
                            <i class="fab fa-telegram-plane fa-2x mb-2"></i>
                            <span>Telegram</span>
                        </button>
                    </div>
                    
                    <!-- WhatsApp (–∑–∞–≥–æ—Ç–æ–≤–∫–∞) -->
                    <div class="col-6 col-md-4">
                        <button class="btn btn-outline-success w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3" 
                                onclick="shareToWhatsApp()">
                            <i class="fab fa-whatsapp fa-2x mb-2"></i>
                            <span>WhatsApp</span>
                        </button>
                    </div>
                    
                    <!-- VK (–∑–∞–≥–æ—Ç–æ–≤–∫–∞) -->
                    <div class="col-6 col-md-4">
                        <button class="btn btn-outline-info w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3" 
                                onclick="shareToVK()">
                            <i class="fab fa-vk fa-2x mb-2"></i>
                            <span>VKontakte</span>
                        </button>
                    </div>
                    
                    <!-- Facebook (–∑–∞–≥–æ—Ç–æ–≤–∫–∞) -->
                    <div class="col-6 col-md-4">
                        <button class="btn btn-outline-primary w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3" 
                                onclick="shareToFacebook()">
                            <i class="fab fa-facebook fa-2x mb-2"></i>
                            <span>Facebook</span>
                        </button>
                    </div>
                    
                    <!-- Twitter (–∑–∞–≥–æ—Ç–æ–≤–∫–∞) -->
                    <div class="col-6 col-md-4">
                        <button class="btn btn-outline-info w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3" 
                                onclick="shareToTwitter()">
                            <i class="fab fa-twitter fa-2x mb-2"></i>
                            <span>Twitter</span>
                        </button>
                    </div>
                    
                    <!-- –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É -->
                    <div class="col-6 col-md-4">
                        <button class="btn btn-outline-secondary w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3" 
                                onclick="copyToClipboard()">
                            <i class="fas fa-copy fa-2x mb-2"></i>
                            <span>{% trans "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å" %}</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏
function shareToTelegram() {
    const url = encodeURIComponent(window.location.href);
    const title = encodeURIComponent('{{ movie.title_uz|escapejs }}');
    const text = encodeURIComponent('{% trans "–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —ç—Ç–æ—Ç —Ñ–∏–ª—å–º" %}: ');
    const telegramUrl = `https://t.me/share/url?url=${url}&text=${text}${title}`;
    window.open(telegramUrl, '_blank', 'width=600,height=400');
    $('#shareModal').modal('hide');
}

function shareToWhatsApp() {
    const url = encodeURIComponent(window.location.href);
    const text = encodeURIComponent('{% trans "–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —ç—Ç–æ—Ç —Ñ–∏–ª—å–º" %}: {{ movie.title_uz|escapejs }}');
    const whatsappUrl = `https://api.whatsapp.com/send?text=${text}%20${url}`;
    window.open(whatsappUrl, '_blank');
    $('#shareModal').modal('hide');
}

function shareToVK() {
    const url = encodeURIComponent(window.location.href);
    const title = encodeURIComponent('{{ movie.title_uz|escapejs }}');
    const vkUrl = `https://vk.com/share.php?url=${url}&title=${title}`;
    window.open(vkUrl, '_blank', 'width=600,height=400');
    $('#shareModal').modal('hide');
}

function shareToFacebook() {
    const url = encodeURIComponent(window.location.href);
    const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
    window.open(facebookUrl, '_blank', 'width=600,height=400');
    $('#shareModal').modal('hide');
}

function shareToTwitter() {
    const url = encodeURIComponent(window.location.href);
    const text = encodeURIComponent('{% trans "–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —ç—Ç–æ—Ç —Ñ–∏–ª—å–º" %}: {{ movie.title_uz|escapejs }}');
    const twitterUrl = `https://twitter.com/intent/tweet?url=${url}&text=${text}`;
    window.open(twitterUrl, '_blank', 'width=600,height=400');
    $('#shareModal').modal('hide');
}

function copyToClipboard() {
    const url = window.location.href;
    navigator.clipboard.writeText(url).then(function() {
        showToast('{% trans "–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞" %}', 'success');
        $('#shareModal').modal('hide');
    }).catch(function() {
        // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
        const textArea = document.createElement('textarea');
        textArea.value = url;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        showToast('{% trans "–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞" %}', 'success');
        $('#shareModal').modal('hide');
    });
}
</script>
{% endblock %}

